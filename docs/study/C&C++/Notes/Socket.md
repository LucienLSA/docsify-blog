---
title: 并发网络通信-套接字通信(C/C++ 多线程)
katex: true
categories: 
- cpp
- 网络
tags:
- socket
- 网络通信
- linux
---

# 网络通信-套接字socket
## 概念
socket 传输数据有好几种模式，套接字对应的是UDP协议，stream流对应的是TCP协议，记清楚。

## socket编程
### 字节序
通信双方交流的信息单元（比特、字节、字、双字等等）应该以什么样的顺序进行传送。如果不达成一致的规则，通信双方将无法进行正确的编/译码从而导致通信失败。

字节序，顾名思义字节的顺序，就是大于一个字节类型的数据在内存中的存放顺序，也就是说对于单字符来说是没有字节序问题的，字符串是单字符的集合，因此字符串也没有字节序问题

计算机中通常采用的字节存储机制主要有两种：Big-Endian（网络字节序） 和 Little-Endian（主机字节序）

#### Little-Endian->主机字节序(小端)
1. 数据的低位字节存储到内存的低地址位, 数据的高位字节存储到内存的高地址位
2. 使用的PC机，数据的存储默认使用的是小端

#### Big-Endian -> 网络字节序 (大端)
1. 数据的低位字节存储到内存的高地址位, 数据的高位字节存储到内存的低地址位
2. 套接字通信过程中操作的数据都是大端存储的，包括：接收/发送的数据、IP地址、端口。

#### 函数
包括从主机字节序到网络字节序的转换函数：htons、htonl；从网络字节序到主机字节序的转换函数：ntohs、ntohl

### IP地址转换
```c
// 主机字节序的IP地址是字符串, 网络字节序IP地址是整形
int inet_pton(int af, const char *src, void *dst); 
```
参数:
af: 地址族(IP地址的家族包括ipv4和ipv6)协议
AF_INET: ipv4格式的ip地址
AF_INET6: ipv6格式的ip地址
src: 传入参数, 对应要转换的点分十进制的ip地址: 192.168.1.100
dst: 传出参数, 函数调用完成, 转换得到的大端整形IP被写入到这块内存中
返回值：成功返回1，失败返回0或者-1

```c
#include <arpa/inet.h>
// 将大端的整形数, 转换为小端的点分十进制的IP地址        
const char *inet_ntop(int af, const void *src, char *dst, socklen_t size);
```
参数:

af: 地址族协议
AF_INET: ipv4格式的ip地址
AF_INET6: ipv6格式的ip地址
src: 传入参数, 这个指针指向的内存中存储了大端的整形IP地址
dst: 传出参数, 存储转换得到的小端的点分十进制的IP地址
size: 修饰dst参数的, 标记dst指向的内存中最多可以存储多少个字节
返回值:

成功: 指针指向第三个参数对应的内存地址, 通过返回值也可以直接取出转换得到的IP字符串
失败: NULL


